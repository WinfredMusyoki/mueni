<html>
    <style type="text/css" media="screen">
        #section1>div{
            position:absolute;
            margin-left:500px;
            margin-top: -75px;
        }
        #results{
            float: right;
        }
        /* Put your CSS styling here */


    </style>

    <script type="text/javascript">
        var theId,id;	
        notused =[];
        used=[];
        indies = [];
        IndArray = [];
        
        maps = false;
        charts = false;
        reports = false;
        indicators = false;
	
        function printIt(id)
        {
            $("#child").html("");
		
            $.get(id+'.json',function(json)
            { 
                $(json.indicators).each(function(i, data)
                {
                    if(data.name==""){$("#child").html("<p style='color:grey;'>no indicators</p>");}
                    var anchor = $("<p></p>").html(data.name);
                    $("#child").append(anchor);
                });
            });
        }
        
        function emptyResults(){
            $("#results").html("");
        }
        
        function addToResults(something){
            $("#results").append($(something));
            console.log("Adding "+something);
        }
        
        function getData(url, field, loopAction, done){
            done = done || function(){};
            $.ajax({
                url: url,
                type: 'GET',
                success: function(json){
                    $(json[field]).each(function(i,data){
                        loopAction(i, data);
                    });
                    done();
                }
            })
        }
        
        function addClickablePara(name, id){
            var anchor = createItem(name, '<li/>', {'class': 'blue', 'click': printIt(id)});
            addToResults(anchor);
        }
	   	
        function search2(){
            emptyResults();
            
            getData('../api/indicators/query/'+'.json', 'indicators', function(i, data){
                theId=data.href;
                
                addClickablePara(data.name);
            });
                                
        }
        
        function addPara(name){
            var anchor = createItem(name, '<li/>', {'class': 'blue'});
            addToResults(anchor);
        }
        
        function createItem(name, tag, options){
            tag = tag || '<li/>';
            options = options || {};
            options['text'] = name || options['text'] || '';
            return $(tag, options);
        }
        
        function doneGetting(){
            if(maps && charts && reports && indicators){
                difference = $.grep(indies, function(item){
                   return $.inArray(item, used) < 0; 
                });
                emptyResults();
                $(difference).each(function(i, data){
                   addPara(data); 
                });
            }
        }
        
        function notUsed(){
            getData('../api/mapViews'+'.json', 'mapViews', function(i, data){
                getData("../api/mapViews/"+data.id+".json", 'indicator', function(index, d){
                    if($.inArray(d.name, used)==-1){	 
                        used.push(d.name);
                    }
                });
            }, function(){
                maps = true;
                doneGetting();
            });
            getData('../api/charts'+'.json', 'charts', function(i, data){
                getData("../api/charts/"+data.id+".json", 'indicators', function(index, d){
                    if($.inArray(d.name, used)==-1){	 
                        used.push(d.name);
                    }
                });
            }, function(){
                charts = true;
                doneGetting();
            });
            getData('../api/reports'+'.json', 'reports', function(i, data){
                getData("../api/reports/"+data.id+".json", 'indicators', function(index, d){
                    if($.inArray(d.name, used)==-1){	 
                        used.push(d.name);	
                    }
                });
            }, function(){
                reports = true;
                doneGetting();
            });
            getData('../api/indicators/query/'+'.json', 'indicators', function(i, data){
                if($.inArray(data.name, indies)==-1){	 
                        indies.push(data.name);	
                    }
            }, function(){
                indicators = true;
                doneGetting();
            });
        }
        
        function Used()
        { 
            emptyResults();
            used = [];
            
            getData('../api/mapViews'+'.json', 'mapViews', function(i, data){
                getData("../api/mapViews/"+data.id+".json", 'indicator', function(index, d){
                    if($.inArray(d.name, used)==-1){	 
                        used.push(d.name);
                        addPara(d.name);
                    }
                });
            });
            getData('../api/charts'+'.json', 'charts', function(i, data){
                getData("../api/charts/"+data.id+".json", 'indicators', function(index, d){
                    if($.inArray(d.name, used)==-1){	 
                        used.push(d.name);
                        addPara(d.name);
                    }
                });
            });
            getData('../api/reports'+'.json', 'reports', function(i, data){
                getData("../api/reports/"+data.id+".json", 'indicators', function(index, d){
                    if($.inArray(d.name, used)==-1){	 
                        used.push(d.name);	
                        addPara(d.name);
                    }
                });
            });
            				
        }   
    </script>

    <h1> STATISTICS FOR INDICATORS</h1>
    <div style="float:left;height:100%;">
        <ol id="results"></ol>
    </div>
    <div>
        <table>
            <td><button  onclick="javascript:search2()" style="color: grey; size: 100px">INDICATORS</button> <br> </td>
            <td><button onclick="javascript:Used()" style="color: grey; size: 100px">USED</button> <br></td>
            <td><button onclick="javascript:notUsed()" style="color: grey; size: 100px">NOT USED</button></td>
        </table>
    </div>



    <div id="child" style="position:absolute;left:50%;">
    </div>
    <div id="summary" style="background-color:gray; position: absolute;" > 
    </div>
    <div id = "section1">
    </div>
</div>        

<div id="rightBar">
    <span id="hideRightBar"><a href="javascript:hideHelpContent()" title="Close">
            <img id="hideRightBarImg" src="../images/hide.png" alt="Close"/></a>
    </span>
    <div id="rightBarContents"/>
</div>

</body>
</html>
